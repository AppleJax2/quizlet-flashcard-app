import{a as $,r as c,R as q,j as e,L as V}from"./index-311eb106.js";import{u as X}from"./index.esm-301e9dda.js";import{t as _,z as m}from"./index-8b2133c0.js";import{C as w,a as C,B as j}from"./Card-05bb7dd2.js";import{f as G}from"./flashcard.service-000b262e.js";import{p as H}from"./processor.service-8cf8a9dd.js";const K=10*1024*1024,Q=["application/pdf","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/msword","text/plain"],W=m.object({title:m.string().min(1,"Title is required"),maxCards:m.number().int().min(5).max(100),includeImages:m.boolean().default(!1),includeExamples:m.boolean().default(!0),file:m.any().refine(a=>(a==null?void 0:a.length)>0,"File is required").refine(a=>{var o;return((o=a==null?void 0:a[0])==null?void 0:o.size)<=K},"File size must be less than 10MB").refine(a=>{var o;return Q.includes((o=a==null?void 0:a[0])==null?void 0:o.type)},"Only PDF, DOC, DOCX, and TXT files are accepted")});function re(){var P,I;const a=$(),o=c.useRef(null),[x,p]=c.useState(!1),[d,v]=c.useState([]),[S,f]=c.useState(null),[M,k]=c.useState("input"),[h,D]=c.useState(null),[N,E]=c.useState(0),{register:u,handleSubmit:R,watch:g,formState:{errors:l},setValue:b}=X({resolver:_(W),defaultValues:{title:"",maxCards:20,includeImages:!0,includeExamples:!0}}),n=g("file");q.useEffect(()=>{if(n!=null&&n[0]&&(D(n[0].name),!g("title"))){const s=n[0].name.split(".")[0];b("title",s.charAt(0).toUpperCase()+s.slice(1))}},[n,b,g]);const L=async s=>{p(!0),f(null),E(0);try{const r=s.file[0],t=new FormData;t.append("file",r),t.append("title",s.title),t.append("maxCards",s.maxCards.toString()),t.append("includeImages",s.includeImages.toString()),t.append("includeExamples",s.includeExamples.toString());const i=await H.processDocument(t,y=>{E(y)});v(i.cards),k("review")}catch(r){f("Failed to process document. Please try again."),console.error(r)}finally{p(!1)}},T=async()=>{p(!0),f(null);try{const s=g("title"),r=await G.createSet({title:s,description:`Generated from document processing on ${new Date().toLocaleDateString()}`,cards:d.map(t=>({front:t.question,back:t.answer,imageUrl:t.imageUrl||null}))});a(`/flashcards/${r}`)}catch(s){f("Failed to save flashcards. Please try again."),console.error(s)}finally{p(!1)}},F=(s,r,t)=>{const i=[...d];i[s]={...i[s],[r]:t},v(i)},z=s=>{v(d.filter((r,t)=>t!==s))},U=s=>{s.preventDefault(),s.stopPropagation()},A=s=>{s.preventDefault(),s.stopPropagation(),s.dataTransfer.files.length&&b("file",s.dataTransfer.files)},O=(s,r=2)=>{if(s===0)return"0 Bytes";const t=1024,i=r<0?0:r,y=["Bytes","KB","MB","GB"],B=Math.floor(Math.log(s)/Math.log(t));return parseFloat((s/Math.pow(t,B)).toFixed(i))+" "+y[B]};return e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-neutral-900",children:"Document Processor"}),e.jsx("p",{className:"mt-2 text-neutral-600",children:"Upload a document and convert its content into flashcards for effective studying."})]}),S&&e.jsx("div",{className:"mb-6 rounded-lg border border-red-200 bg-red-50 p-4 text-red-700",children:S}),M==="input"?e.jsx(w,{children:e.jsx(C,{className:"p-6",children:e.jsxs("form",{onSubmit:R(L),className:"space-y-6",children:[e.jsxs("div",{className:`flex flex-col items-center justify-center rounded-lg border-2 border-dashed p-6 ${l.file?"border-red-300 bg-red-50":"border-neutral-300 bg-neutral-50"}`,onDragOver:U,onDrop:A,children:[e.jsx("svg",{className:`mb-4 h-12 w-12 ${l.file?"text-red-400":"text-neutral-400"}`,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),e.jsx("div",{className:"mb-4 text-center",children:h?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("p",{className:"text-sm font-medium text-neutral-700",children:h}),e.jsx("button",{type:"button",onClick:()=>{b("file",null),D(null)},className:"text-sm text-red-600 hover:text-red-500",children:"Remove"})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"mb-1 text-sm font-medium text-neutral-700",children:"Drag and drop your file here, or click to select"}),e.jsx("p",{className:"text-xs text-neutral-500",children:"PDF, DOC, DOCX, TXT up to 10MB"})]})}),e.jsx("input",{id:"file",type:"file",ref:o,className:"hidden",accept:".pdf,.doc,.docx,.txt",...u("file")}),e.jsx("button",{type:"button",className:"inline-flex items-center rounded-md border border-neutral-300 bg-white px-4 py-2 text-sm font-medium text-neutral-700 shadow-sm hover:bg-neutral-50 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2",onClick:()=>{var s;return(s=o.current)==null?void 0:s.click()},children:"Select File"}),l.file&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:(P=l.file.message)==null?void 0:P.toString()})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"title",className:"block text-sm font-medium text-neutral-700",children:"Set Title"}),e.jsx("input",{id:"title",type:"text",className:`mt-1 block w-full rounded-md border ${l.title?"border-red-300":"border-neutral-300"} px-3 py-2 shadow-sm focus:border-primary-500 focus:outline-none focus:ring-primary-500 sm:text-sm`,placeholder:"Enter a title for your flashcard set",...u("title")}),l.title&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.title.message})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"maxCards",className:"block text-sm font-medium text-neutral-700",children:"Maximum Cards"}),e.jsx("input",{id:"maxCards",type:"number",min:"5",max:"100",className:`mt-1 block w-full rounded-md border ${l.maxCards?"border-red-300":"border-neutral-300"} px-3 py-2 shadow-sm focus:border-primary-500 focus:outline-none focus:ring-primary-500 sm:text-sm`,...u("maxCards",{valueAsNumber:!0})}),l.maxCards&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:l.maxCards.message})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{id:"includeImages",type:"checkbox",className:"h-4 w-4 rounded border-neutral-300 text-primary-600 focus:ring-primary-500",...u("includeImages")}),e.jsx("label",{htmlFor:"includeImages",className:"ml-2 block text-sm text-neutral-700",children:"Include relevant images (when available)"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{id:"includeExamples",type:"checkbox",className:"h-4 w-4 rounded border-neutral-300 text-primary-600 focus:ring-primary-500",...u("includeExamples")}),e.jsx("label",{htmlFor:"includeExamples",className:"ml-2 block text-sm text-neutral-700",children:"Include examples in answers"})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx(V,{to:"/dashboard",children:e.jsx(j,{type:"button",variant:"outline",children:"Cancel"})}),e.jsx(j,{type:"submit",isLoading:x,children:x?"Processing...":"Generate Flashcards"})]}),x&&N>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"mb-1 text-sm text-neutral-700",children:"Uploading and processing..."}),e.jsx("div",{className:"h-2 w-full rounded-full bg-neutral-200",children:e.jsx("div",{className:"h-2 rounded-full bg-primary-600",style:{width:`${N}%`}})}),e.jsxs("p",{className:"mt-1 text-xs text-neutral-500",children:[N,"% complete"]})]})]})})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(w,{children:e.jsxs(C,{className:"p-6",children:[e.jsxs("div",{className:"mb-4 flex justify-between",children:[e.jsx("h2",{className:"text-xl font-bold text-neutral-900",children:"Review Generated Cards"}),e.jsxs("p",{className:"text-sm text-neutral-600",children:[d.length," cards generated"]})]}),e.jsx("p",{className:"text-neutral-600",children:"Review and edit your cards before saving them to your flashcard set."}),h&&e.jsxs("p",{className:"mt-2 text-xs text-neutral-500",children:["Source: ",h," (",((I=n==null?void 0:n[0])==null?void 0:I.size)&&O(n[0].size),")"]})]})}),d.map((s,r)=>e.jsx(w,{children:e.jsxs(C,{className:"p-6",children:[e.jsxs("div",{className:"mb-4 grid grid-cols-12 gap-4",children:[e.jsxs("div",{className:"col-span-12 sm:col-span-6",children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700",children:"Question"}),e.jsx("textarea",{rows:3,value:s.question,onChange:t=>F(r,"question",t.target.value),className:"mt-1 block w-full rounded-md border border-neutral-300 px-3 py-2 shadow-sm focus:border-primary-500 focus:outline-none focus:ring-primary-500 sm:text-sm"})]}),e.jsxs("div",{className:"col-span-12 sm:col-span-6",children:[e.jsx("label",{className:"block text-sm font-medium text-neutral-700",children:"Answer"}),e.jsx("textarea",{rows:3,value:s.answer,onChange:t=>F(r,"answer",t.target.value),className:"mt-1 block w-full rounded-md border border-neutral-300 px-3 py-2 shadow-sm focus:border-primary-500 focus:outline-none focus:ring-primary-500 sm:text-sm"})]})]}),s.imageUrl&&e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"mb-2 text-sm font-medium text-neutral-700",children:"Image"}),e.jsx("img",{src:s.imageUrl,alt:"Card illustration",className:"h-32 w-auto rounded-md border border-neutral-200 object-cover"})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{type:"button",onClick:()=>z(r),className:"inline-flex items-center rounded-md border border-transparent px-3 py-2 text-sm font-medium leading-4 text-red-700 hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"mr-2 h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})}),"Remove Card"]})})]})},r)),e.jsxs("div",{className:"flex justify-between space-x-3",children:[e.jsx(j,{type:"button",variant:"outline",onClick:()=>k("input"),children:"Back to Editor"}),e.jsx(j,{type:"button",isLoading:x,onClick:T,disabled:d.length===0,children:"Save Flashcard Set"})]})]})]})}export{re as default};
